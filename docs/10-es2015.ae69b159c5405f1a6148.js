(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{tmrb:function(e,t,i){"use strict";i.r(t),i.d(t,"Tab1PageModule",(function(){return X}));var o=i("TEn/"),n=i("ofXK"),s=i("3Pt+"),r=i("fXoL");let a=(()=>{class e{}return e.\u0275mod=r.Hb({type:e}),e.\u0275inj=r.Gb({factory:function(t){return new(t||e)},imports:[[n.b,o.D]]}),e})();var c,l=i("tyNb"),d=i("mrSG"),h=i("HDdC"),b=i("gcOT");!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSED=2]="CLOSED"}(c||(c={}));var g=function(e,t,i,o){return new(i||(i=Promise))((function(n,s){function r(e){try{c(o.next(e))}catch(t){s(t)}}function a(e){try{c(o.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}c((o=o.apply(e,t||[])).next())}))};const m=new class extends b.b{constructor(){super({name:"EventSource",platforms:["web"]})}configure(e){return g(this,void 0,void 0,(function*(){if(console.debug(`EventSourceWeb.configure(${e.url})`),!e.url)throw new Error("url is required");this.url=e.url}))}open(){return g(this,void 0,void 0,(function*(){if(console.debug("EventSourceWeb.open()"),!this.url)throw new Error("call configure first");this.eventSource=new window.EventSource(this.url),this.notifyListeners("readyStateChanged",{state:c.CONNECTING}),this.eventSource.addEventListener("error",e=>{this.notifyListeners("error",{error:null==e?void 0:e.message})}),this.eventSource.addEventListener("message",e=>{this.notifyListeners("message",{message:null==e?void 0:e.data})}),this.eventSource.addEventListener("open",e=>{this.notifyListeners("open",{message:null==e?void 0:e.message}),this.notifyListeners("readyStateChanged",{state:c.OPEN})})}))}close(){return g(this,void 0,void 0,(function*(){console.debug("EventSourceWeb.close()"),this.eventSource&&(this.eventSource.close(),this.notifyListeners("readyStateChanged",{state:c.CLOSED}))}))}};Object(b.c)(m);const{App:u,Device:f,EventSource:p,Network:y}=b.a;class v{constructor(){this.isConnected=!0,this.lastUpdated=0,this.lastRetry=0,this.maxRetryMillis=6e5,this.defaultRetryMillis=1e4,this.defaultCheckIntervalMillis=5e3,this.defaultRetryFallback=1.2,this.retryMillis=this.defaultRetryMillis,console.debug(`APIService(): default retry:          ${this.defaultRetryMillis}ms`),console.debug(`APIService(): default check interval: ${this.defaultCheckIntervalMillis}ms`),console.debug(`APIService(): default retry fallback: ${this.defaultRetryFallback}x`),f.getInfo().then(e=>{"web"!==e.platform?this.init("https://www.blaseball.com/events/streamData"):this.init()}).catch(e=>{this.init()})}init(e){return Object(d.a)(this,void 0,void 0,(function*(){console.debug("APIService.init(): initializing."),this.isStarted=!1,this.observable=h.a.create(e=>{this.observer=e}),e?(console.debug("APIService.init(): pre-configured URL: "+e),this.url=e):this.url="https://cors-proxy.blaseball-reference.com/events/streamData";try{this.isActive=(yield u.getState()).isActive}catch(t){console.error("APIService.init(): failed to get app state, assuming active.",t),this.isActive=!0}try{this.isConnected=(yield y.getStatus()).connected}catch(t){console.error("APIService.init(): failed to get connection state, assuming connected.",t),this.isConnected=!0}u.addListener("appStateChange",e=>Object(d.a)(this,void 0,void 0,(function*(){try{const t=yield f.getInfo();console.debug(`APIService.init() isActive: ${this.isActive} -> ${e.isActive}`),e.isActive?this.handleSystemChange(!0):"web"!==t.platform&&this.handleSystemChange()}catch(t){console.debug("APIService.init() isActive: Device.getInfo() failed, assuming web",t)}}))),y.addListener("networkStatusChange",e=>{console.debug(`APIService.init() isConnected: ${this.isConnected} -> ${e.connected}`),e.connected&&this.handleSystemChange(!0)})}))}handleSystemChange(e){console.debug("APIService.handleSystemChange(): retrigger="+e),this.isStarted?!e&&this.source||(console.debug("APIService.handleSystemChange(): (re)creating connection"),this.createSource(),this.startCheckingLastUpdated()):(console.debug("APIService.handleSystemChange(): shutting down"),this.retryChecker&&(clearInterval(this.retryChecker),this.retryChecker=null),this.closeSource(),this.source=null)}start(){return console.info("APIService.start()"),this.isStarted=!0,this.handleSystemChange(),this.observable}stop(){console.info("APIService.stop()"),this.isStarted=!1,this.handleSystemChange(),this.observer.complete(),this.observer=null,this.observable=null,this.retryMillis=this.defaultRetryMillis,this.lastUpdated=0}retry(){return console.debug("APIService.retry()"),new Promise((e,t)=>{try{this.lastRetry=Date.now(),this.closeSource();const t=Math.floor(Math.min(this.maxRetryMillis,this.retryMillis*this.defaultRetryFallback));console.debug(`APIService.retry(): ${this.retryMillis} -> ${t}`),this.retryMillis=t,e(this.createSource())}catch(i){t(i)}})}onMessage(e){console.debug("APIService.onMessage()");const t=new MessageEvent("message",{data:e});this.lastUpdate!==t.data&&(this.retryMillis!==this.defaultRetryMillis&&(console.debug(`APIService.onMessage(): ${this.retryMillis} -> ${this.defaultRetryMillis}`),this.retryMillis=this.defaultRetryMillis),this.lastUpdated=Date.now(),this.lastUpdate=t.data,this.observer&&this.observer.next(t))}createSource(){return console.debug("APIService.createSource()"),new Promise((e,t)=>{this.closeSource(),p.configure({url:this.url}),p.addListener("message",t=>{this.onMessage(t.message),e(!0)}),p.addListener("error",e=>{if(console.error("APIService.createSource(): An error occurred reading from the event source.  Resetting.",e.error),t(!0),this.observer){const t=new ErrorEvent("error",{message:e.error});this.observer.next(t)}else console.debug("APIService.createSource(): No observer?");this.checkLastUpdated()}),p.open(),this.source=p})}closeSource(){try{p.close(),this.source=null}catch(e){console.warn("APIService.closeSource(): failed to close event source:",e)}}startCheckingLastUpdated(){console.debug("APIService.startCheckingLastUpdated()"),this.retryChecker&&clearInterval(this.retryChecker),setTimeout(()=>{this.retryChecker=setInterval(()=>{this.checkLastUpdated()},this.defaultCheckIntervalMillis)},this.defaultCheckIntervalMillis)}checkLastUpdated(){const e=Math.max(this.lastUpdated,this.lastRetry),t=Date.now();this.hourChecker||(this.hourChecker=setTimeout(()=>{console.debug("APIService.checkLastUpdate(): new hour, force a check."),this.checkLastUpdated()},t-t%36e5+36e5));const i=Math.round(this.lastRetry%36e5/36e5*100),o=Math.round(t%36e5/36e5*100);o<i&&(console.debug(`APIService.checkLastUpdated(): hour reset (${o} < ${i})`),this.retryMillis=this.defaultRetryMillis,clearTimeout(this.hourChecker),this.hourChecker=null);const n=e+this.retryMillis;console.debug(`APIService.checkLastUpdated(): now=${this.formatDate(t)}, lastUpdated=${this.formatDate(this.lastUpdated)}, lastRetry=${this.formatDate(this.lastRetry)}, threshold=${this.formatDate(n)}, retryMillis=${(this.retryMillis/1e3/1).toPrecision(2)}s`),t>n?this.retry():console.debug(`APIService.checkLastUpdated(): ${this.formatDate(t)} < ${this.formatDate(n)}`)}formatDate(e){return("number"==typeof e?new Date(e):e).toISOString()}}const{Storage:k}=b.a;let w=(()=>{class e{constructor(){this.settings={segment:"all",favorites:{}},console.debug("SettingsService instantiated."),this.ready=this.init()}init(){return Object(d.a)(this,void 0,void 0,(function*(){return console.debug("SettingsService initializing."),this.assertSettings(),k.get({key:"favorites"}).then(e=>(console.debug("SettingsService: ret=",e),e&&void 0!==e.value&&(this.settings.favorites=JSON.parse(e.value)),k.get({key:"segment"}).then(e=>(this.settings.segment=e.value||"all",console.debug("SettingsService: settings=",this.settings),!0)))).catch(e=>(console.error("SettingsService: failed to get favorites:",e),this.settings={segment:"all",favorites:{}},!0))}))}assertSettings(){this.settings||(this.settings={}),this.settings.favorites||(this.settings.favorites={}),this.settings.segment||(this.settings.segment="all")}isFavorite(e){return this.assertSettings(),Boolean(this.settings.favorites[e])}setFavorite(e,t){this.assertSettings(),this.settings.favorites[e]=t,k.set({key:"favorites",value:JSON.stringify(this.settings.favorites)}).then(()=>{console.debug(`set favorite: ${e} = ${t}`)})}toggleFavorite(e){this.assertSettings(),this.setFavorite(e,!this.isFavorite(e))}getSegment(){return this.assertSettings(),this.settings.segment}setSegment(e){this.assertSettings(),this.settings.segment=e,k.set({key:"segment",value:e}).then(()=>{console.debug("set segment: "+e)})}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=r.Fb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function M(e,t){1&e&&r.Kb(0,"ion-icon",20)}function L(e,t){1&e&&r.Kb(0,"ion-icon",21)}function S(e,t){1&e&&r.Kb(0,"ion-icon",20)}function C(e,t){1&e&&r.Kb(0,"ion-icon",21)}function x(e,t){if(1&e&&(r.Wb(),r.Mb(0,"svg",22),r.Mb(1,"g",23),r.Kb(2,"path",24),r.Kb(3,"path",25),r.Kb(4,"path",26),r.Kb(5,"path",27),r.Kb(6,"rect",28),r.Kb(7,"path",29),r.Kb(8,"path",30),r.Kb(9,"rect",31),r.Kb(10,"path",32),r.Kb(11,"path",33),r.Kb(12,"rect",34),r.Kb(13,"rect",35),r.Kb(14,"rect",36),r.Kb(15,"path",37),r.Kb(16,"rect",38),r.Kb(17,"rect",39),r.Kb(18,"path",40),r.Mb(19,"text",41),r.jc(20),r.Lb(),r.Mb(21,"text",42),r.jc(22),r.Lb(),r.Mb(23,"text",43),r.jc(24),r.Lb(),r.Mb(25,"text",44),r.jc(26),r.Lb(),r.Mb(27,"text",45),r.jc(28),r.Lb(),r.Lb(),r.Lb()),2&e){const e=r.Xb();r.zb(19),r.Ab("x",e.coordinates.first[0])("y",e.coordinates.first[1])("font-size",e.playerFontSize),r.zb(1),r.kc(e.getName(e.getBaseRunner(0))),r.zb(1),r.Ab("x",e.coordinates.second[0])("y",e.coordinates.second[1])("font-size",e.playerFontSize),r.zb(1),r.kc(e.getName(e.getBaseRunner(1))),r.zb(1),r.Ab("x",e.coordinates.third[0])("y",e.coordinates.third[1])("font-size",e.playerFontSize),r.zb(1),r.kc(e.getName(e.getBaseRunner(2))),r.zb(1),r.Ab("font-size",e.playerFontSize),r.zb(1),r.kc(e.getName(e.getBatter())),r.zb(1),r.Ab("font-size",e.playerFontSize),r.zb(1),r.kc(e.getName(e.getPitcher()))}}function I(e,t){if(1&e&&(r.Mb(0,"span"),r.jc(1),r.Lb()),2&e){const e=r.Xb(2);r.zb(1),r.lc("(",e.game.inning+1,")")}}function z(e,t){if(1&e&&(r.Mb(0,"ion-col",46),r.Mb(1,"div"),r.jc(2,"FINAL "),r.ic(3,I,2,1,"span",47),r.Lb(),r.Lb()),2&e){const e=r.Xb();r.zb(3),r.ac("ngIf",e.game.inning>8)}}function P(e,t){if(1&e&&(r.Mb(0,"ion-col",46),r.Mb(1,"div"),r.jc(2,"INNING\xa0"),r.Mb(3,"div",48),r.Kb(4,"div",49),r.jc(5),r.Lb(),r.Lb(),r.Lb()),2&e){const e=r.Xb();r.zb(4),r.ac("innerHTML",e.game.topOfInning?"\u25b2":"\u25bc",r.ec),r.zb(1),r.lc(" ",e.game.inning+1,"")}}let j=(()=>{class e{constructor(e){this.settings=e,this.positions={first:null,second:null,third:null,home:null,pitcher:null},this.refresh=new r.n,this.playerFontSize="1.1rem",this.coordinates={first:[430,355],second:[328,190],third:[225,355]},console.debug("Diamond component created.")}ngOnInit(){return Object(d.a)(this,void 0,void 0,(function*(){return console.debug("Diamond component initialized."),console.debug(this.game),this.settings.ready}))}isFavorite(e){return this.settings.isFavorite(e)}toggleFavorite(e){this.settings.toggleFavorite(e),this.refresh&&(console.debug("toggleFavorite(): refreshing"),this.refresh.emit())}inProgress(){return this.game&&!this.game.gameComplete}getName(e){return e&&e.name?e.name:null}getBaseRunner(e){if(this.inProgress())for(let t=0;t<this.game.basesOccupied.length;t++)if(this.game.basesOccupied[t]===e)return{name:this.game.baseRunnerNames[t],id:this.game.baseRunners[t]};return null}getPitcher(){return this.inProgress()?this.game.topOfInning?{id:this.game.homePitcher,name:this.game.homePitcherName}:{id:this.game.awayPitcher,name:this.game.awayPitcherName}:null}getBatter(){if(this.inProgress())return this.game.topOfInning?{id:this.game.awayBatter,name:this.game.awayBatterName}:{id:this.game.homeBatter,name:this.game.homeBatterName}}getEmoji(e){switch(e){case"home":return String.fromCodePoint(this.game.homeTeamEmoji);case"away":return String.fromCodePoint(this.game.awayTeamEmoji);default:return""}}}return e.\u0275fac=function(t){return new(t||e)(r.Jb(w))},e.\u0275cmp=r.Db({type:e,selectors:[["app-diamond"]],inputs:{positions:"positions",homeTeam:"homeTeam",awayTeam:"awayTeam",game:"game"},outputs:{refresh:"refresh"},decls:57,vars:23,consts:[[1,"green-card","ion-no-padding","ion-no-margin"],["color","transparent",1,"ion-no-padding"],["color","transparent"],["slot","start"],["fill","clear","shape","round","size","large",3,"click"],["name","star-outline",4,"ngIf"],["name","star",4,"ngIf"],[1,"ion-no-padding"],[1,"team-header"],[1,"team-lozenge"],[1,"team-emoji",3,"innerHTML"],["slot","end"],[0,"xmlns","svg","http://www.w3.org/2000/svg","xmlns","http://www.w3.org/2000/svg",0,"xmlns","sodipodi","http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd",0,"xmlns","inkscape","http://www.inkscape.org/namespaces/inkscape","id","diamond","version","1.0","preserveAspectRatio","xMinYMin meet","viewBox","0 120 650 390",4,"ngIf"],[1,"scorebox"],[1,"ion-align-items-end","ion-text-end"],[1,"scorebox-box"],["class","ion-text-end",4,"ngIf"],["size","12"],[1,"scorebox-border"],["id","lastUpdate",1,"rotate-display"],["name","star-outline"],["name","star"],[0,"xmlns","svg","http://www.w3.org/2000/svg","xmlns","http://www.w3.org/2000/svg",0,"xmlns","sodipodi","http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd",0,"xmlns","inkscape","http://www.inkscape.org/namespaces/inkscape","id","diamond","version","1.0","preserveAspectRatio","xMinYMin meet","viewBox","0 120 650 390"],["id","main"],["id","background","d","M 150,520 L 0,520 L 0,0 L 650,0 L 650,520 L 508,520 L 150,520 z ",0,"sodipodi","nodetypes","ccccccc",2,"fill","#00a831","fill-opacity","1","fill-rule","evenodd","stroke","none","stroke-width","1px","stroke-linecap","butt","stroke-linejoin","miter","stroke-opacity","1"],["id","dirt",0,"sodipodi","type","arc",0,"sodipodi","cx","300",0,"sodipodi","cy","752.36218",0,"sodipodi","rx","95",0,"sodipodi","ry","95","d","M 205,752.36218 A 95,95 0 0 1 395,752.36218",0,"sodipodi","start","3.1415927",0,"sodipodi","end","6.2831853",0,"sodipodi","open","true","transform","matrix(1.989102,0,0,1.978205,-268.2308,-1169.879)",2,"opacity","1","fill","#a48e28","fill-opacity","1","stroke","#85881b","stroke-width","1.04379344","stroke-linecap","butt","stroke-linejoin","bevel","stroke-miterlimit","4","stroke-dasharray","none","stroke-opacity","1"],["id","dirt-corner-right","d","M 328.5,439.48263 L 538.5,229.48266 L 538.5,439.48263 L 328.5,439.48263 z ",2,"fill","#00a831","fill-opacity","1","fill-rule","evenodd","stroke","none","stroke-width","1px","stroke-linecap","butt","stroke-linejoin","miter","stroke-opacity","1"],["id","dirt-corner-left","d","M 328.5,439.48263 L 124.5,235.48266 L 123.5,439.48263 L 328.5,439.48263 z ",2,"fill","#00a831","fill-opacity","1","fill-rule","evenodd","stroke","none","stroke-width","1px","stroke-linecap","butt","stroke-linejoin","miter","stroke-opacity","1"],["id","diamond-grass","width","168.31494","height","168.31494","x","-77.781464","y","374.03622","transform","matrix(0.707107,-0.707107,0.707107,0.707107,0,0)",2,"opacity","1","fill","#00a837","fill-opacity","1","stroke","#85881b","stroke-width","4.99999857","stroke-linecap","butt","stroke-linejoin","miter","stroke-miterlimit","4","stroke-dasharray","none","stroke-opacity","1"],["id","dirt-home",0,"sodipodi","type","arc",0,"sodipodi","cx","328",0,"sodipodi","cy","430",0,"sodipodi","rx","43",0,"sodipodi","ry","43","d","M 371 430 A 43 43 0 1 1  285,430 A 43 43 0 1 1  371 430 z",2,"opacity","1","fill","#85881b","fill-opacity","1","stroke","none","stroke-width","1","stroke-linecap","butt","stroke-linejoin","miter","stroke-miterlimit","4","stroke-dasharray","none","stroke-opacity","1"],["id","pitchers-mound",0,"sodipodi","type","arc",0,"sodipodi","cx","300",0,"sodipodi","cy","752.36218",0,"sodipodi","rx","18",0,"sodipodi","ry","18","d","M 318 752.36218 A 18 18 0 1 1  282,752.36218 A 18 18 0 1 1  318 752.36218 z","transform","translate(28.5,-432.8794)",2,"opacity","1","fill","#b56700","fill-opacity","1","stroke","#85881b","stroke-width","2","stroke-linecap","round","stroke-linejoin","round","stroke-miterlimit","4","stroke-dasharray","none","stroke-opacity","1"],["id","pitchers-plate","width","14","height","4","x","321.5","y","317.4827",2,"opacity","1","fill","white","fill-opacity","1","stroke","none","stroke-width","3","stroke-linecap","butt","stroke-linejoin","miter","stroke-miterlimit","4","stroke-dasharray","none","stroke-opacity","1"],["id","foul-line-right","d","M 363.00993,405 C 650.37706,117.62236 650.37706,117.62236 650.37706,117.62236",2,"fill","none","fill-opacity","0.75","fill-rule","evenodd","stroke","white","stroke-width","3.01047993","stroke-linecap","square","stroke-linejoin","miter","stroke-miterlimit","4","stroke-dasharray","none","stroke-opacity","1"],["id","foul-line-left","d","M 293.77042,404.99993 C -2.1085256,109.12113 -2.1085256,109.12113 -2.1085256,109.12113",2,"fill","none","fill-opacity","0.75","fill-rule","evenodd","stroke","white","stroke-width","3","stroke-linecap","butt","stroke-linejoin","miter","stroke-miterlimit","4","stroke-dasharray","none","stroke-opacity","1"],["id","base-1","width","10.242652","height","10.242652","x","531.56042","y","-95.300102","transform","matrix(0.707107,0.707107,-0.707107,0.707107,0,0)",2,"opacity","1","fill","white","fill-opacity","1","stroke","none","stroke-width","3","stroke-linecap","butt","stroke-linejoin","miter","stroke-miterlimit","4","stroke-dasharray","none","stroke-opacity","1"],["id","base-2","width","10.242655","height","10.242655","x","369.26904","y","-95.643242","transform","matrix(0.707107,0.707107,-0.707107,0.707107,0,0)",2,"opacity","1","fill","white","fill-opacity","1","stroke","none","stroke-width","3","stroke-linecap","butt","stroke-linejoin","miter","stroke-miterlimit","4","stroke-dasharray","none","stroke-opacity","1"],["id","base-3","width","10.242649","height","10.242649","x","369.26904","y","66.99128","transform","matrix(0.707107,0.707107,-0.707107,0.707107,0,0)",2,"opacity","1","fill","white","fill-opacity","1","stroke","none","stroke-width","3","stroke-linecap","butt","stroke-linejoin","miter","stroke-miterlimit","4","stroke-dasharray","none","stroke-opacity","1"],["id","base-home","d","M 320,423 L 335,423 L 335,430.7492 L 327.72761,438 L 320,429.78055 L 320,423 z ",0,"sodipodi","nodetypes","cccccc",2,"fill","white","fill-opacity","1","stroke","none","stroke-width","3","stroke-linecap","butt","stroke-linejoin","miter","stroke-miterlimit","4","stroke-opacity","1"],["id","batters-box-right","width","15","height","35","x","340","y","410",2,"opacity","1","fill","#85881b","fill-opacity","1","stroke","white","stroke-width","1","stroke-linecap","butt","stroke-linejoin","miter","stroke-miterlimit","4","stroke-dasharray","none","stroke-opacity","1"],["id","batters-box-left","width","15","height","35","x","300","y","410",2,"opacity","1","fill","#85881b","fill-opacity","1","stroke","white","stroke-width","1","stroke-linecap","butt","stroke-linejoin","miter","stroke-miterlimit","4","stroke-dasharray","none","stroke-opacity","1"],["id","border-home","d","M 295,405 C 295.15103,402.74278 293.1875,403.97917 292.28125,403.46875 C 280.62645,419.16193 280.35712,439.683 291.625,455.65625 C 305.77503,475.71519 333.59731,480.52502 353.65625,466.375 C 373.71519,452.22497 378.52502,424.40269 364.375,404.34375 L 361,405 C 362.65625,407.375 361,405 362.65625,407.375 L 293.875,406.53125 L 295,405 z M 293.875,406.53125 L 362.65625,407.375 C 374.80016,425.99135 370.24983,450.98832 351.9375,463.90625 C 333.20494,477.12061 307.30812,472.67006 294.09375,453.9375 C 283.82751,439.38417 283.83997,421.05606 293.875,406.53125 z ",0,"sodipodi","nodetypes","ccsscccccccssc",2,"opacity","1","fill","white","fill-opacity","1","stroke","none","stroke-width","3","stroke-linecap","butt","stroke-linejoin","miter","stroke-miterlimit","4","stroke-dasharray","none","stroke-opacity","1"],["id","player-1","text-anchor","start","font-family","sans-serif","font-weight","bold","fill","white"],["id","player-2","text-anchor","middle","font-family","sans-serif","font-weight","bold","fill","white"],["id","player-3","text-anchor","end","font-family","sans-serif","font-weight","bold","fill","white"],["id","player-home","x","328","y","500","text-anchor","middle","font-family","sans-serif","font-weight","bold","fill","white"],["id","pitcher","x","328","y","296","text-anchor","middle","font-family","sans-serif","font-weight","bold","fill","white"],[1,"ion-text-end"],[4,"ngIf"],[1,"scorebox-inning"],[1,"inning-marker",3,"innerHTML"]],template:function(e,t){1&e&&(r.Mb(0,"ion-card",0),r.Mb(1,"ion-card-header",1),r.Mb(2,"ion-toolbar",2),r.Mb(3,"ion-buttons",3),r.Mb(4,"ion-button",4),r.Ub("click",(function(){return t.toggleFavorite(t.game.awayTeam)})),r.ic(5,M,1,0,"ion-icon",5),r.ic(6,L,1,0,"ion-icon",6),r.Lb(),r.Lb(),r.Mb(7,"ion-title",7),r.Mb(8,"div",8),r.Mb(9,"div",9),r.Kb(10,"span",10),r.jc(11),r.Lb(),r.jc(12," at "),r.Mb(13,"div",9),r.jc(14),r.Kb(15,"span",10),r.Lb(),r.Lb(),r.Lb(),r.Mb(16,"ion-buttons",11),r.Mb(17,"ion-button",4),r.Ub("click",(function(){return t.toggleFavorite(t.game.homeTeam)})),r.ic(18,S,1,0,"ion-icon",5),r.ic(19,C,1,0,"ion-icon",6),r.Lb(),r.Lb(),r.Lb(),r.Lb(),r.Mb(20,"ion-card-content",7),r.ic(21,x,29,16,"svg",12),r.Mb(22,"ion-grid",13),r.Mb(23,"ion-row",14),r.Mb(24,"ion-col"),r.Mb(25,"div"),r.jc(26,"BALL\xa0"),r.Mb(27,"div",15),r.jc(28),r.Lb(),r.Lb(),r.Lb(),r.Mb(29,"ion-col"),r.Mb(30,"div"),r.jc(31,"STRIKE\xa0"),r.Mb(32,"div",15),r.jc(33),r.Lb(),r.Lb(),r.Lb(),r.Mb(34,"ion-col"),r.Mb(35,"div"),r.jc(36,"OUT\xa0"),r.Mb(37,"div",15),r.jc(38),r.Lb(),r.Lb(),r.Lb(),r.Lb(),r.Mb(39,"ion-row",14),r.Mb(40,"ion-col"),r.Mb(41,"div"),r.jc(42,"AWAY\xa0"),r.Mb(43,"div",15),r.jc(44),r.Lb(),r.Lb(),r.Lb(),r.ic(45,z,4,1,"ion-col",16),r.ic(46,P,6,2,"ion-col",16),r.Mb(47,"ion-col"),r.Mb(48,"div"),r.jc(49,"HOME\xa0"),r.Mb(50,"div",15),r.jc(51),r.Lb(),r.Lb(),r.Lb(),r.Lb(),r.Mb(52,"ion-row"),r.Mb(53,"ion-col",17),r.Mb(54,"div",18),r.Mb(55,"div",19),r.jc(56),r.Lb(),r.Lb(),r.Lb(),r.Lb(),r.Lb(),r.Lb(),r.Lb()),2&e&&(r.zb(5),r.ac("ngIf",!t.isFavorite(t.game.awayTeam)),r.zb(1),r.ac("ngIf",t.isFavorite(t.game.awayTeam)),r.zb(4),r.hc("background-color: ",t.game.awayTeamColor,""),r.ac("innerHTML",t.getEmoji("away"),r.ec),r.zb(1),r.lc(" ",t.game.awayTeamNickname," "),r.zb(3),r.lc(" ",t.game.homeTeamNickname," "),r.zb(1),r.hc("background-color: ",t.game.homeTeamColor,""),r.ac("innerHTML",t.getEmoji("home"),r.ec),r.zb(3),r.ac("ngIf",!t.isFavorite(t.game.homeTeam)),r.zb(1),r.ac("ngIf",t.isFavorite(t.game.homeTeam)),r.zb(2),r.ac("ngIf",t.inProgress()),r.zb(7),r.kc(t.game.atBatBalls),r.zb(5),r.kc(t.game.atBatStrikes),r.zb(5),r.kc(t.game.halfInningOuts),r.zb(6),r.kc(t.game.awayScore),r.zb(1),r.ac("ngIf",t.game.gameComplete),r.zb(1),r.ac("ngIf",!t.game.gameComplete),r.zb(5),r.kc(t.game.homeScore),r.zb(5),r.kc(t.game.lastUpdate))},directives:[o.e,o.g,o.C,o.d,o.c,n.i,o.B,o.f,o.j,o.t,o.h,o.l],styles:[".green-card[_ngcontent-%COMP%]{--color:#fff;--background:#00a831}.team-header[_ngcontent-%COMP%]{color:#fff;font-size:3.5vw;font-weight:700;text-align:center}@-webkit-keyframes fadeIn{0%{opacity:0}to{opacity:1}}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}@-webkit-keyframes fadeOut{0%{opacity:1}to{opacity:0}}@keyframes fadeOut{0%{opacity:1}to{opacity:0}}.scorebox[_ngcontent-%COMP%]{font-family:scoreboard,sans-serif;width:95%;margin-left:auto;margin-right:auto;margin-bottom:.75em;text-align:center;background-color:#000;border:5px solid #fff;font-size:3.1vw;font-weight:700}.scorebox[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.5em}.scorebox[_ngcontent-%COMP%]   .scorebox-border[_ngcontent-%COMP%]{font-family:scoreboard,sans-serif;border:2px solid #ff0;display:inline-block;text-align:left;padding:.1em .5em;width:100%;height:6em}.scorebox[_ngcontent-%COMP%]   .scorebox-box[_ngcontent-%COMP%]{padding:.1em .25em}.scorebox[_ngcontent-%COMP%]   .scorebox-box[_ngcontent-%COMP%], .scorebox[_ngcontent-%COMP%]   .scorebox-inning[_ngcontent-%COMP%]{font-family:scoreboard,sans-serif;border:2px solid #ff0;display:inline-block;text-align:right;width:2.8em}.scorebox[_ngcontent-%COMP%]   .scorebox-inning[_ngcontent-%COMP%]{position:relative;padding:.1em .25em .1em .1em}.scorebox[_ngcontent-%COMP%]   .inning-marker[_ngcontent-%COMP%]{position:absolute;top:.6em;left:.4em;padding:0;margin:0;display:inline-block;font-size:60%;vertical-align:middle}.team-lozenge[_ngcontent-%COMP%]{display:inline-block;margin-top:.25em;margin-bottom:.25em}.team-emoji[_ngcontent-%COMP%]{border:1px solid #008024;border-radius:1em;display:inline-block;width:1.5em;height:1.5em}"]}),e})();function O(e,t){1&e&&(r.Mb(0,"ion-button"),r.Kb(1,"ion-spinner"),r.Lb())}function A(e,t){if(1&e){const e=r.Nb();r.Mb(0,"ion-toolbar"),r.Mb(1,"ion-buttons",8),r.Mb(2,"ion-button"),r.Kb(3,"ion-icon"),r.Lb(),r.Lb(),r.Mb(4,"ion-segment",9),r.Ub("ionChange",(function(t){return r.dc(e),r.Xb().segmentChanged(t)})),r.Mb(5,"ion-segment-button",10),r.Mb(6,"ion-label"),r.jc(7,"All"),r.Lb(),r.Lb(),r.Mb(8,"ion-segment-button",11),r.Mb(9,"ion-label"),r.jc(10,"Active"),r.Lb(),r.Lb(),r.Mb(11,"ion-segment-button",12),r.Mb(12,"ion-label"),r.jc(13,"Favorites"),r.Lb(),r.Lb(),r.Lb(),r.Mb(14,"ion-buttons",2),r.Mb(15,"ion-button",13),r.Ub("click",(function(){return r.dc(e),r.Xb().toggleSearchbar()})),r.Kb(16,"ion-icon",14),r.Lb(),r.Lb(),r.Lb()}if(2&e){const e=r.Xb();r.zb(4),r.ac("value",e.segment)}}function T(e,t){if(1&e){const e=r.Nb();r.Mb(0,"ion-searchbar",15),r.Ub("ionInput",(function(t){return r.dc(e),r.Xb().filterList(t)})),r.Lb()}if(2&e){const e=r.Xb();r.bc("value",e.searchTerm)}}function N(e,t){if(1&e&&(r.Mb(0,"span"),r.Mb(1,"ion-item",16),r.Mb(2,"h4"),r.jc(3),r.Lb(),r.Lb(),r.Mb(4,"ion-item",16),r.Mb(5,"h4"),r.jc(6,"The "),r.Mb(7,"span"),r.jc(8),r.Lb(),r.jc(9," are the Champions!"),r.Lb(),r.Lb(),r.Mb(10,"ion-item",16),r.Mb(11,"h4"),r.jc(12),r.Lb(),r.Lb(),r.Lb()),2&e){const e=r.Xb();r.zb(3),r.lc("Season ",e.data.games.season.seasonNumber+1," is over."),r.zb(4),r.hc("color: ",e.getWinner().mainColor,""),r.zb(1),r.kc(e.getWinner().fullName),r.zb(4),r.lc("Next Season Starts In ",e.getNextSeasonStart(),".")}}function U(e,t){if(1&e&&(r.Mb(0,"h4",20),r.jc(1),r.Lb()),2&e){const e=r.Xb(3);r.zb(1),r.mc("Postseason Round ",e.data.games.postseason.round.roundNumber+1,", Day ",e.data.games.postseason.playoffs.playoffDay+1,"")}}function F(e,t){if(1&e&&(r.Mb(0,"ion-item",16),r.ic(1,U,2,2,"h4",19),r.Lb()),2&e){const e=r.Xb(2);r.zb(1),r.ac("ngIf",e.data&&e.data.games)}}function E(e,t){if(1&e&&(r.Mb(0,"h4",20),r.jc(1),r.Lb()),2&e){const e=r.Xb(3);r.zb(1),r.mc("Season ",e.data.games.season.seasonNumber+1,", Day ",e.data.games.sim.day+1,"")}}function D(e,t){if(1&e&&(r.Mb(0,"ion-item",16),r.ic(1,E,2,2,"h4",19),r.Lb()),2&e){const e=r.Xb(2);r.zb(1),r.ac("ngIf",e.data&&e.data.games)}}function R(e,t){if(1&e&&(r.Mb(0,"ion-item",16),r.jc(1),r.Lb()),2&e){const e=r.Xb(2);r.zb(1),r.lc(" No more active games for day ",e.data.games.sim.day+1,". ")}}function $(e,t){if(1&e){const e=r.Nb();r.Mb(0,"ion-col",21),r.Mb(1,"app-diamond",22),r.Ub("refresh",(function(){return r.dc(e),r.Xb(2).refreshUI()})),r.Lb(),r.Lb()}if(2&e){const e=t.$implicit;r.zb(1),r.ac("game",e)}}function K(e,t){if(1&e&&(r.Mb(0,"span"),r.ic(1,F,2,1,"ion-item",17),r.ic(2,D,2,1,"ion-item",17),r.ic(3,R,2,1,"ion-item",17),r.Mb(4,"ion-grid"),r.Mb(5,"ion-row"),r.ic(6,$,2,1,"ion-col",18),r.Lb(),r.Lb(),r.Lb()),2&e){const e=r.Xb();r.zb(1),r.ac("ngIf",e.isPostseason()),r.zb(1),r.ac("ngIf",!e.isPostseason()),r.zb(1),r.ac("ngIf","active"===e.segment&&(!e.games||0===e.games.length)),r.zb(3),r.ac("ngForOf",e.games)("ngForTrackBy",e.gameId)}}const B=[{path:"",component:(()=>{class e{constructor(e,t){this.loadingController=e,this.settings=t,this.positions={first:null,second:null,third:null,home:null,pitcher:null},this.data={},this.games=[],this.segment="all",this.ready=!1,this.errors=0,this.lastUpdate=Date.now(),this.filterVisible=!1,this.stale=!1,this.staleThreshold=3e4,this.api=new v,this.countdown={hours:0,minutes:0,seconds:0}}ngOnInit(){return Object(d.a)(this,void 0,void 0,(function*(){console.debug("Stream.ngOnInit()"),this.showLoading(),this.settings.ready.finally(()=>{this.segment=this.settings.getSegment(),this.startListening(),this.ready=!0})}))}ngOnDestroy(){return Object(d.a)(this,void 0,void 0,(function*(){this.ready=!1,this.subscription&&(this.subscription.unsubscribe(),this.subscription=void 0,this.api.stop())}))}showLoading(){return Object(d.a)(this,void 0,void 0,(function*(){this.loading=!0}))}hideLoading(){return Object(d.a)(this,void 0,void 0,(function*(){this.loading=!1}))}forceRefresh(e){setTimeout(()=>{this.api.retry().finally(()=>{e.target.complete()})},500)}toggleSearchbar(){this.filterVisible=!this.filterVisible,console.debug("Stream.toggleSearchbar(): filterVisible="+this.filterVisible)}filterList(e){return this.searchTerm=e.srcElement.value,this.refreshUI()}getSegmentGames(){return console.debug("Stream.getSegmentGames()"),this.data&&this.data.games&&this.data.games.schedule?this.data.games.schedule.filter(e=>{switch(this.segment){case"all":return!0;case"active":return!e.gameComplete;case"favorites":return this.settings.isFavorite(e.homeTeam)||this.settings.isFavorite(e.awayTeam);default:return console.warn("Stream.getSegmentGames(): unhandled segment: "+this.segment),!1}}).sort((e,t)=>{const i=e.homeTeamNickname,o=t.homeTeamNickname;return i<o?-1:i>o?1:0}):[]}isPostseason(){var e,t,i;return Boolean(void 0!==(null===(i=null===(t=null===(e=null==this?void 0:this.data)||void 0===e?void 0:e.games)||void 0===t?void 0:t.postseason)||void 0===i?void 0:i.playoffs))}isFinished(){const e=Boolean(void 0!==this.getWinner());return this.clockUpdater&&!e?(clearInterval(this.clockUpdater),this.clockUpdater=void 0):!this.clockUpdater&&e&&(this.clockUpdater=setInterval(()=>{const e=Date.now(),t=new Date(this.data.games.sim.nextSeasonStart).getTime(),i=Math.floor((t-e)/1e3);this.countdown.hours=Math.floor(i/60/60);let o=i-60*this.countdown.hours*60;this.countdown.minutes=Math.floor(o/60),this.countdown.seconds=o-60*this.countdown.minutes})),e}getWinner(){var e,t,i,o;const n=null===(o=null===(i=null===(t=null===(e=null==this?void 0:this.data)||void 0===e?void 0:e.games)||void 0===t?void 0:t.postseason)||void 0===i?void 0:i.playoffs)||void 0===o?void 0:o.winner;if(n)return this.data.leagues.teams.find(e=>e.id===n)}getNextSeasonStart(){return`${this.countdown.hours} ${1===this.countdown.hours?"hour":"hours"}, ${this.countdown.minutes} ${1===this.countdown.minutes?"minute":"minutes"}, ${this.countdown.seconds} ${1===this.countdown.seconds?"second":"seconds"}`}refreshUI(){console.debug("Stream.refreshUI()");let e=this.getSegmentGames();return this.searchTerm&&this.searchTerm.length>=2&&(e=e.filter(e=>e.homeTeamName.toLowerCase().indexOf(this.searchTerm.toLowerCase())>-1||e.awayTeamName.toLowerCase().indexOf(this.searchTerm.toLowerCase())>-1)),this.games=e,this.games}segmentChanged(e){e&&e.detail&&e.detail.value&&(this.segment=e.detail.value,this.settings.setSegment(this.segment)),console.debug("Stream.segmentChanged():",e),this.refreshUI()}checkStale(){const e=this.stale;if(this.games&&this.games.length>0){const e=this.games.find(e=>!e.gameComplete);this.stale=!!e&&this.lastUpdate+this.staleThreshold<Date.now()}console.debug(`Stream.checkStale(): ${e} -> ${this.stale}`)}onEvent(e){if("error"===e.type)return void this.onError(e);this.lastUpdate=Date.now(),setTimeout(()=>{this.errors=0,this.checkStale()},1e3);const t=JSON.parse(e.data).value;this.data||(this.data={});for(const i of Object.keys(t))this.data[i]=t[i];console.debug("Stream.onEvent(): current data:",this.data),this.refreshUI(),this.hideLoading()}onError(e){console.debug("Stream.onError():",e),this.hideLoading(),this.loading=!1,setTimeout(()=>{this.errors++,this.checkStale()},1e3)}startListening(){console.debug("Stream.startListening(): opening event stream to blaseball.com"),this.showLoading();const e=this.api.start();this.subscription=e.subscribe(e=>{this.onEvent(e)},e=>{this.onError(e)})}gameId(e,t){return t&&t.id?t.id:String(e)}}return e.\u0275fac=function(t){return new(t||e)(r.Jb(o.F),r.Jb(w))},e.\u0275cmp=r.Db({type:e,selectors:[["app-tab1"]],decls:14,vars:6,consts:[[3,"translucent"],["color","primary"],["slot","secondary"],[4,"ngIf"],["slot","fixed",3,"ionRefresh"],["pullingIcon","baseball-outline"],["name","default"],["debounce","200","showCancelButton","focus",3,"value","ionInput",4,"ngIf"],["slot","primary"],[3,"value","ionChange"],["value","all"],["value","active"],["value","favorites"],[3,"click"],["name","search-outline"],["debounce","200","showCancelButton","focus",3,"value","ionInput"],["lines","none"],["lines","none",4,"ngIf"],["size","12",4,"ngFor","ngForOf","ngForTrackBy"],["class","ion-no-margin",4,"ngIf"],[1,"ion-no-margin"],["size","12"],[3,"game","refresh"]],template:function(e,t){1&e&&(r.Mb(0,"ion-header",0),r.Mb(1,"ion-toolbar",1),r.Mb(2,"ion-title"),r.jc(3," Blases Loaded "),r.Lb(),r.Mb(4,"ion-buttons",2),r.ic(5,O,2,0,"ion-button",3),r.Lb(),r.Lb(),r.ic(6,A,17,1,"ion-toolbar",3),r.Lb(),r.Mb(7,"ion-content"),r.Mb(8,"ion-refresher",4),r.Ub("ionRefresh",(function(e){return t.forceRefresh(e)})),r.Mb(9,"ion-refresher-content",5),r.Kb(10,"ion-spinner",6),r.Lb(),r.Lb(),r.ic(11,T,1,1,"ion-searchbar",7),r.ic(12,N,13,6,"span",3),r.ic(13,K,7,5,"span",3),r.Lb()),2&e&&(r.ac("translucent",!0),r.zb(5),r.ac("ngIf",t.loading||t.stale),r.zb(1),r.ac("ngIf",t.ready&&!t.isFinished()),r.zb(5),r.ac("ngIf",t.filterVisible),r.zb(1),r.ac("ngIf",t.isFinished()),r.zb(1),r.ac("ngIf",!t.isFinished()))},directives:[o.k,o.C,o.B,o.d,n.i,o.i,o.q,o.r,o.x,o.c,o.l,o.v,o.H,o.w,o.n,o.u,o.I,o.m,o.j,o.t,n.h,o.h,j],styles:[".danger[_ngcontent-%COMP%]{color:#fff;background-color:var(--ion-color-danger);text-align:center;padding:4em}.danger[_ngcontent-%COMP%]   .big[_ngcontent-%COMP%]{font-size:200%;font-weight:700}ion-item[_ngcontent-%COMP%], ion-searchbar[_ngcontent-%COMP%]{transition:.1s ease-in-out}"]}),e})()}];let _=(()=>{class e{}return e.\u0275mod=r.Hb({type:e}),e.\u0275inj=r.Gb({factory:function(t){return new(t||e)},imports:[[l.i.forChild(B)],l.i]}),e})(),X=(()=>{class e{}return e.\u0275mod=r.Hb({type:e}),e.\u0275inj=r.Gb({factory:function(t){return new(t||e)},imports:[[o.D,n.b,s.a,_,a]]}),e})()}}]);